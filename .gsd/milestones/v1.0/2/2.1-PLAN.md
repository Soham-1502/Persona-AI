---
phase: 2
plan: 1
wave: 1
depends_on: []
files_modified: [app/components/confidence-coach/ConfidenceCoachUI.jsx, app/api/confidence-coach/generate-questions/route.js]
autonomous: true

must_haves:
  truths:
    - "Selecting a scenario queries the API to fetch a dynamically generated question"
    - "API uses @google/genai SDK to generate questions within free tier limits"
    - "The selected question is accurately recorded in the session payload"
  artifacts:
    - "app/api/confidence-coach/generate-questions/route.js"
---

# Plan 2.1: AI-Generated Scenario Questions

<objective>
Purpose: Replace the static hardcoded scenario names with dynamic, AI-generated practice questions using Gemini to provide a realistic experience.
Output: An API endpoint that serves scenario variations and frontend integration to fetch them when a scenario category is selected.
</objective>

<context>
Load for context:
- app/components/confidence-coach/ConfidenceCoachUI.jsx
</context>

<tasks>

<task type="auto">
  <name>Create Question Generation API Endpoint</name>
  <files>app/api/confidence-coach/generate-questions/route.js</files>
  <action>
    Create a `POST` handler at `/api/confidence-coach/generate-questions`.
    Accept a payload extracting `scenarioType` (e.g. "Job Interview").
    Use the global initialized `@google/genai` client (or instantiate one with `process.env.GEMINI_API_KEY`) to prompt for exactly 1 realistic practice question for the given scenario.
    Format the response as `{ question: "The generated string" }`.
    AVOID: Returning arrays, Markdown formatting, or chat wrapper text in the generated output. Request plain text.
  </action>
  <verify>Ensure `genai` is utilized correctly and route securely handles errors.</verify>
  <done>Endpoint successfully yields a string question string for a given intent.</done>
</task>

<task type="auto">
  <name>Integrate Dynamic Scenarios into UI</name>
  <files>app/components/confidence-coach/ConfidenceCoachUI.jsx</files>
  <action>
    Add a new `scenarioCategory` state to hold the dropdown value.
    Re-purpose `question` state to hold the actual string generated by the new API.
    When `scenarioCategory` changes (or upon initial load), display a loading state and fetch the generated question from `/api/confidence-coach/generate-questions`.
    Display the deeply-generated question text above the Video pane or within the instructions so the user knows what to respond to.
    Update `payload.question` inside `endSession` to reflect this new specific generated question string, rather than just the generic category.
    AVOID: Blocking the UI thread entirely during API generation. Fail gracefully to a fallback static question if the API fails or rate-limits.
  </action>
  <verify>React component fetches and displays the AI-generated string.</verify>
  <done>UI correctly handles the sub-selection and prepares the exact question for tracking.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Changing drop down selection triggers the API call.
- [ ] API successfully uses Gemini to generate a scoped text question.
- [ ] The generated string successfully maps into the final payload payload during the POST `/api/confidence-coach/session` call.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
