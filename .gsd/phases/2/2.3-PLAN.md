---
phase: 2
plan: 3
wave: 3
depends_on: [1, 2]
files_modified: [app/components/confidence-coach/ConfidenceCoachUI.jsx, package.json]
autonomous: true

must_haves:
  truths:
    - "@picovoice/porcupine-web is installed and configured"
    - "Wake words 'Jarvis' (or standard Porcupine defaults) start and stop the session autonomously"
    - "Manual start button still works as a fallback"
  artifacts:
    - "package.json"
---

# Plan 2.3: True Hands-Free Wake Words

<objective>
Purpose: Upgrade the generic Web Speech API keyword spotting ("start", "end this speech") to a robust offline wake word engine using Picovoice Porcupine for true hands-free activation.
Output: Integrated `usePorcupine` react bindings starting and stopping the analysis session based on specific hotwords.
</objective>

<context>
Load for context:
- app/components/confidence-coach/ConfidenceCoachUI.jsx
</context>

<tasks>

<task type="auto">
  <name>Install Porcupine Dependencies</name>
  <files>package.json</files>
  <action>
    Install `@picovoice/porcupine-web` and `@picovoice/web-voice-processor`.
    AVOID: Modifying other dependency versions.
  </action>
  <verify>Check package.json for standard installation of picovoice modules.</verify>
  <done>NPM packages are installed securely.</done>
</task>

<task type="auto">
  <name>Integrate Porcupine Wake Words into UI</name>
  <files>app/components/confidence-coach/ConfidenceCoachUI.jsx</files>
  <action>
    Import the Porcupine worker bindings.
    Initialize Porcupine using a publicly available test access key from the `.env` (expect `NEXT_PUBLIC_PICOVOICE_ACCESS_KEY` to exist).
    Load the default English keywords (e.g. `Porcupine` or `Bumblebee` or `Jarvis` if available via built-in keyword arguments in the web package).
    Bind the `keywordDetectionCallback` to trigger `startSession()` when the start wake word is heard, and `endSession()` when the stop wake word is heard.
    Remove or retain the old `SpeechRecognition` block *only* for the transcript `userAnswer` accumulation, ensuring it no longer is responsible for the flaky Start/End keyword detection.
    AVOID: Hardcoding an access key or accidentally removing the transcription logic. Porcupine *only* does wake words; Web Speech API is still needed for the `userAnswer` transcript accumulation.
  </action>
  <verify>Ensure `NEXT_PUBLIC_PICOVOICE_ACCESS_KEY` usage pattern and callback logic is structurally sound without syntax errors.</verify>
  <done>Session controls are managed by Porcupine offline WASM instances.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Dependencies are cleanly installed.
- [ ] The `keywordDetectionCallback` routes to the respective `startSession`/`endSession` commands securely.
- [ ] The existing transcript generation (`Web Speech API`) is untouched regarding `userAnswer` accumulation.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
