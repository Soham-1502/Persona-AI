---
phase: 2
plan: 2
wave: 2
depends_on: [1]
files_modified: [app/components/confidence-coach/MediaPipeAnalyzer.js, app/components/confidence-coach/ConfidenceCoachUI.jsx]
autonomous: true

must_haves:
  truths:
    - "Advanced posture detection actively measures 'openness' score based on shoulder and elbow relative width"
    - "New posture metrics affect the final holistic calculation weighting"
  artifacts:
    - "app/components/confidence-coach/MediaPipeAnalyzer.js"
---

# Plan 2.2: Advanced Body Language & Openness Analytics

<objective>
Purpose: Upgrade the simple "Sitting vs Standing" detection from Phase 1 to actively evaluate "Openness" (arms spread, shoulders back) to measure defensive vs open body language.
Output: Enriched MediaPipe posture calculations and weighting in the ConfidenceScore.
</objective>

<context>
Load for context:
- app/components/confidence-coach/MediaPipeAnalyzer.js
- app/components/confidence-coach/ConfidenceCoachUI.jsx
</context>

<tasks>

<task type="auto">
  <name>Enhance Posture with Openness Calculation</name>
  <files>app/components/confidence-coach/MediaPipeAnalyzer.js</files>
  <action>
    Upgrade `determinePosture` or add a new `evaluateOpenness` function.
    Extract landmarks for Shoulders (11, 12) and Wrists (15, 16).
    Calculate the horizontal distance (x-axis) between the wrists compared to the horizontal distance of the shoulders.
    If the wrist distance is significantly wider than shoulder distance (and visible), mark `posture.openness` as "open".
    If the wrist distance is very narrow or crossed inwards the shoulders, mark `posture.openness` as "closed".
    Pass this new openness score/metric smoothly back through the `onResults` object pipeline.
    AVOID: Returning openness if wrists or shoulders are not visible on screen.
  </action>
  <verify>Ensure arithmetic mapping X-axis ratios is mathematically safe (no divide by 0).</verify>
  <done>MediaPipe results yield `open` or `closed` metrics efficiently per frame.</done>
</task>

<task type="auto">
  <name>Score Openness in Holistic Aggregation</name>
  <files>app/components/confidence-coach/ConfidenceCoachUI.jsx</files>
  <action>
    Add an `openFrames` to the `mlStats` React state tracker.
    When accumulating results in the callback from MediaPipe, increment `openFrames` if the result marks openness as "open".
    During the `endSession` aggregated math, add a new scoring component: e.g. Open Posture Contribution (+ up to 1.0 points).
    Adjust the other ratios slightly or expand the total base score to cleanly format onto a 1-10 mapping scale cleanly.
    AVOID: Over-penalizing users if their wrists are out of frame. Only calculate openness relative to the frames where visibility was true.
  </action>
  <verify>Check mathematical scoring to ensure total score does not exceed 10.0 or perform NaN mutations.</verify>
  <done>Score factors in wrist-shoulder ratios.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Openness tracking evaluates distances appropriately in the WASM callback.
- [ ] `mlStats` tracks the count of open frames vs closed/visible frames securely.
- [ ] End score calculation correctly handles the math for a 4th metric.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
